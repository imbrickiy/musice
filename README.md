# Musice — минималистичное радио на Flutter

Musice — это небольшой кроссплатформенный радио‑плеер на Flutter. Приложение воспроизводит интернет‑радио (HLS), позволяет выбрать станцию, управлять воспроизведением и громкостью, а также показывает «реактивную» анимацию, которая пульсирует в такт проигрыванию.


## Возможности
- Выбор радиостанции через нижний модальный лист (с безопасным запасным диалогом, если лист не открылся)
- Воспроизведение потоков HLS с помощью `just_audio`
- Кнопка Play/Pause с отображением статусов загрузки/буферизации
- Плавный регулятор громкости с «анимированным» применением значения
- Реактивная анимация «волн» во время проигрывания
- Тёмная тема, шрифт SF Pro
- Для desktop (macOS/Windows/Linux) — фиксированное окно 390×844 (как iPhone 14) через `window_manager`


## Скриншоты

- Главный экран:  
  ![Скриншот 1](lib/assets/screenshot_1.png)
- Выбор станции:  
  ![Скриншот 2](lib/assets/screenshot_2.png)
- Проигрывание и громкость:  
  ![Скриншот 3](lib/assets/screenshot_3.png)


## Технологии
- Flutter (Material 3)
- Dart (см. ограничения SDK в `pubspec.yaml`)
- just_audio
- window_manager


## Быстрый старт

Требования:
- Установленный Flutter SDK (stable)
- Для iOS/macOS: Xcode, CocoaPods
- Для Windows: инструменты сборки Flutter Desktop

Установка зависимостей:
```zsh
flutter pub get
```

Запуск:
- macOS (desktop):
  ```zsh
  flutter run -d macos
  ```
- iOS (симулятор/устройство):
  ```zsh
  flutter run -d ios
  ```
  Примечание: для реального устройства настройте подпись в Xcode (открыть `ios/Runner.xcworkspace`).
- Windows (desktop):
  ```zsh
  flutter run -d windows
  ```

Сборка релиза (примеры):
- macOS:
  ```zsh
  flutter build macos
  ```
- iOS (архив через Xcode рекомендуется):
  ```zsh
  flutter build ipa
  ```
- Windows:
  ```zsh
  flutter build windows
  ```


## Тесты
Запустить все unit/widget тесты:
```zsh
flutter test
```
Тестовые файлы: `test/widget_test.dart`, `test/radio_home_page_test.dart`.


## Структура проекта (основное)
- `lib/main.dart` — входная точка: выбор/старт станции, управление плеером и анимацией, фиксированное desktop‑окно
- `lib/models/station.dart` — модель радиостанции
- `lib/widgets/` — UI‑компоненты:
  - `radio_header.dart` — заголовок с выбором станции
  - `play_section.dart` — секция с Play/Pause и анимацией
  - `volume_section.dart` — регулятор громкости с анимированным применением
  - `station_picker_sheet.dart` — модальный лист выбора станции
  - `wave_pulse.dart` — визуализация «волн»
- `lib/assets/` — изображения/скриншоты
- `lib/fonts/` — шрифт SF Pro (подключён как `family: SFPro` в `pubspec.yaml`)
- `test/` — тесты


## Как добавить/изменить радиостанции
Станции определены в списке `_stations` внутри `lib/main.dart`. Пример элемента:
```text
const Station('Deep', 'https://example.com/playlist.m3u8')
```
Добавьте новую станцию по аналогии — она появится в списке выбора.


## Поведение на разных платформах
- Desktop (macOS/Windows/Linux): окно фиксированного размера 390×844. Задаётся при старте через `window_manager` и соответствует портретной ориентации телефона.
- iOS: полноэкранный мобильный режим.


## Нюансы и советы
- Потоки HLS должны быть доступны из вашей сети. Если воспроизведение не начинается, проверьте доступность URL и сетевые ограничения/VPN/файрвол.
- Ошибки старта/буферизации логируются через `debugPrint` (см. консоль).
- Если при выборе станции нижний лист не открылся (редко), сработает запасной диалог.


## Известные ограничения
- Список станций хранится в коде (`main.dart`). Для продакшена можно вынести его в конфигурацию/бэкенд или добавить локальное «избранное».
- Нет авто‑восстановления потока при обрыве — потенциальное улучшение.


## Лицензия
MIT — см. файл `LICENSE` в корне репозитория.

© 2025 imbrickiy


## Git hooks и CI

В репозитории настроены локальные pre-commit хуки и CI, которые помогают держать код в порядке.

- Pre-commit хук (локально): выполняет генерацию локализаций, кастомный линт (запрещает прямые `Icons.*` в `lib/`), `flutter analyze` и тесты.
- CI (GitHub Actions): запускается для веток `main` и `master` на push/PR и повторяет те же проверки.

Настройка pre-commit:
```zsh
# из корня репозитория
./scripts/setup-git-hooks.sh
```
После этого при каждом коммите автоматически выполнятся проверки:
- `flutter gen-l10n`
- `dart run custom_lint` (запрещает прямые `Icons.*` — используйте `AppIcons`)
- `flutter analyze`
- `flutter test -r compact`

Полезно знать:
- Можно временно пропустить тесты: `SKIP_TESTS=1 git commit -m "msg"`
- Полностью обойти хуки (не рекомендуется): `git commit --no-verify -m "msg"`

CI-триггеры:
- Файл: `.github/workflows/ci.yml`
- По умолчанию триггеры настроены на ветки `main` и `master`.
- Чтобы изменить список веток, отредактируйте секции `on.push.branches` и `on.pull_request.branches` в workflow, например:
```yaml
on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]
```
